list(
label = as.character(year),
method = "restyle",
args = list(
list(x = list(binary2015$diff_overallscore[binary2015$year == year]))
)
)
})
)
)
)
top_n_values <- 5
# Test with ggpot2
custom_colors <- c("blue", "darkblue", "cyan", "green", "darkgreen", "lightgreen", "lightblue","turquoise", "lightgrey", "darkgrey")
library(cowplot)
library(patchwork)
# Get unique regions in the dataset
unique_regions <- unique(binary2015$region)
# Create a color dictionary mapping each region to a specific color
region_colors <- setNames(custom_colors[1:length(unique_regions)], unique_regions)
# Create a common legend manually
legend_data <- data.frame(region = unique_regions)
legend_plot <- ggplot(legend_data, aes(x = region, fill = region)) +
geom_bar(position = position_stack(reverse = TRUE)) +
scale_fill_manual(values = region_colors) +  # Use the specified colors
theme_void() +
theme(
legend.position = "none",
axis.text.y = element_text(angle = 0, hjust = 1)  # Adjust hjust to place text on the right
) +
coord_flip()
plots <- list()
for (year in unique_years) {
top_countries <- binary2015[binary2015$year == year, ] %>%
arrange(desc(year), desc(diff_overallscore)) %>%
head(n = top_n_values)
plot <- ggplot(data = top_countries, mapping = aes(x = country, y = diff_overallscore, fill = region)) +
geom_bar(stat = "identity") +
scale_fill_manual(values = region_colors) +  # Use the specified colors
labs(title = paste("Year", year), x = NULL, y = NULL) +
theme_minimal() +
theme(axis.text.x = element_text(angle = 45, vjust = 1, hjust = 1), legend.position = "none") +
scale_y_continuous(limits = c(0, 3))
plots[[as.character(year)]] <- plot
}
patchwork <- plots[[1]]+ plots[[2]]+plots[[3]]+plots[[4]]+plots[[5]]+plots[[6]]+plots[[7]]+plots[[8]]+plots[[9]]+plots[[10]]+plots[[11]]+plots[[12]]+plots[[13]]+plots[[14]]+legend_plot
patchwork + plot_annotation(
title = 'Worst 5 countries in terms of SDG score improvement'
)
# Arrange the plots in a 4x4 grid using patchwork
grid <- wrap_plots(plots, ncol = 5)
# Combine the grid and legend using patchwork
final_plot <- grid + legend_plot
# Print or save the final combined plot
print(final_plot)
top_n_values <- 20
top_countries <- binary2015 %>%
arrange(desc(diff_overallscore)) %>%
#mutate(year=as.factor(year)) %>%
head(n = top_n_values) %>%
group_by(year, country)
library(viridis)
plot_ly() %>%
add_trace(
type = "bar",
x = ~top_countries$country,
y = ~top_countries$diff_overallscore,
color = ~top_countries$year,
colors = "viridis",
showlegend = TRUE,
marker = list(size = 10),
split = ~interaction(top_countries$country, top_countries$year)
) %>%
layout(
title = paste("Top ", top_n_values, " SDG Score evolution"),
yaxis = list(title = "Year difference SDG score", range = c(0, 3.5)),
xaxis = list(title = "Countries",categoryorder = "total ascending"),
barmode = "stack"
)
top_countries <- binary2015 %>%
arrange(desc(diff_overallscore)) %>%
#mutate(year=as.factor(year)) %>%
head(n = top_n_values)
library(viridis)
plot_ly() %>%
add_trace(
type = "bar",
x = ~top_countries$country,
y = ~top_countries$diff_overallscore,
color = ~top_countries$year,
colors = "viridis",
showlegend = TRUE,
marker = list(size = 10)
) %>%
layout(
title = paste("Top ", top_n_values, " SDG Score evolution"),
yaxis = list(title = "Year difference SDG score", range = c(0, 3.5)),
xaxis = list(title = "Countries",categoryorder = "total ascending"),
barmode = "stack"
)
View(top_countries_2)
plot_ly() %>%
add_trace(
type = "bar",
x = ~top_countries$country,
y = ~top_countries$diff_overallscore,
color = ~top_countries$after2015,
colors = "viridis",
showlegend = TRUE,
marker = list(size = 10)
) %>%
layout(
title = paste("Top ", top_n_values, " SDG Score evolution"),
yaxis = list(title = "Year difference SDG score", range = c(0, 3.5)),
xaxis = list(title = "Countries",categoryorder = "total ascending"),
barmode = "stack"
)
plot_ly() %>%
add_trace(
type = "bar",
x = ~top_countries$country,
y = ~top_countries$diff_overallscore,
color = ~top_countries$after2015,
colors = c("red", "blue"),
showlegend = TRUE,
marker = list(size = 10)
) %>%
layout(
title = paste("Top ", top_n_values, " SDG Score evolution"),
yaxis = list(title = "Year difference SDG score", range = c(0, 3.5)),
xaxis = list(title = "Countries",categoryorder = "total ascending"),
barmode = "stack"
)
plot_ly() %>%
add_trace(
type = "bar",
x = ~top_countries$country[top_countries$after2015 == 1],
y = ~top_countries$diff_overallscore[top_countries$after2015 == 1],
legendgroup = "after 2015",
name = "after 2015",
marker = list(color = "blue", size = 10),
showlegend = TRUE
) %>%
add_trace(
type = "bar",
x = ~top_countries$country[top_countries$after2015 == 0],
y = ~top_countries$diff_overallscore[top_countries$after2015 == 0],
legendgroup = "before 2015",
name = "before 2015",
marker = list(color = "red", size = 10),
showlegend = TRUE
) %>%
layout(
title = paste("Top ", top_n_values, " SDG Score evolution"),
yaxis = list(title = "Year difference SDG score", range = c(0, 3.5)),
xaxis = list(title = "Countries", categoryorder = "total ascending"),
barmode = "stack"
)
plot_ly() %>%
add_trace(
type = "bar",
x = ~top_countries$country[top_countries$after2015 == 1],
y = ~top_countries$diff_overallscore[top_countries$after2015 == 1],
legendgroup = "after 2015",
name = "after 2015",
marker = list(color = "blue", size = 10),
showlegend = TRUE
) %>%
add_trace(
type = "bar",
x = ~top_countries$country[top_countries$after2015 == 0],
y = ~top_countries$diff_overallscore[top_countries$after2015 == 0],
legendgroup = "before 2015",
name = "before 2015",
marker = list(color = "red", size = 10),
showlegend = TRUE
) %>%
layout(
title = paste("Top ", top_n_values, " SDG Score evolution"),
yaxis = list(title = "Year difference SDG score", range = c(0, 3.5)),
xaxis = list(title = "Countries", categoryorder = "total ascending"),
barmode = "stack"
)
plot_ly() %>%
add_trace(
type = "bar",
x = ~top_countries$country[top_countries$after2015 == 1],
y = ~top_countries$diff_overallscore[top_countries$after2015 == 1],
legendgroup = "after 2015",
name = "after 2015",
marker = list(color = "blue", size = 10),
showlegend = TRUE,
position = "dodge"
) %>%
add_trace(
type = "bar",
x = ~top_countries$country[top_countries$after2015 == 0],
y = ~top_countries$diff_overallscore[top_countries$after2015 == 0],
legendgroup = "before 2015",
name = "before 2015",
marker = list(color = "red", size = 10),
showlegend = TRUE,
position = "dodge"
) %>%
layout(
title = paste("Top ", top_n_values, " SDG Score evolution"),
yaxis = list(title = "Year difference SDG score", range = c(0, 3.5)),
xaxis = list(title = "Countries", categoryorder = "total ascending"),
barmode = "stack"
)
top_countries %>%
group_by(after2015) %>%
plot_ly(
type = "bar",
x = ~country,
y = ~diff_overallscore,
color = ~as.factor(after2015),
colors = c("red", "blue"),
showlegend = TRUE,
marker = list(size = 10)
) %>%
layout(
title = paste("Top ", top_n_values, " SDG Score evolution"),
yaxis = list(title = "Year difference SDG score", range = c(0, 3.5)),
xaxis = list(title = "Countries", categoryorder = "total ascending")
)
plot_ly() %>%
add_trace(
type = "bar",
x = ~top_countries$country[top_countries$after2015 == 1],
y = ~top_countries$diff_overallscore[top_countries$after2015 == 1],
legendgroup = "after 2015",
name = "after 2015",
marker = list(color = "blue", size = 10)
) %>%
add_trace(
type = "bar",
x = ~top_countries$country[top_countries$after2015 == 0],
y = ~top_countries$diff_overallscore[top_countries$after2015 == 0],
legendgroup = "before 2015",
name = "before 2015",
marker = list(color = "red", size = 10)
) %>%
layout(
title = paste("Top ", top_n_values, " SDG Score evolution"),
yaxis = list(title = "Year difference SDG score", range = c(0, 3.5)),
xaxis = list(title = "Countries", categoryorder = "total ascending")
)
plot_ly() %>%
add_trace(
type = "bar",
x = ~top_countries$country[top_countries$after2015 == 1],
y = ~top_countries$diff_overallscore[top_countries$after2015 == 1],
legendgroup = "after 2015",
name = "after 2015",
marker = list(color = "blue", size = 10)
) %>%
add_trace(
type = "bar",
x = ~top_countries$country[top_countries$after2015 == 0],
y = ~top_countries$diff_overallscore[top_countries$after2015 == 0],
legendgroup = "before 2015",
name = "before 2015",
marker = list(color = "red", size = 10)
) %>%
layout(
title = paste("Top ", top_n_values, " SDG Score evolution"),
yaxis = list(title = "Year difference SDG score", range = c(0, 3.5)),
xaxis = list(title = "Countries", categoryorder = "total ascending")
)
top_n_values <- 40
top_countries <- binary2015 %>%
arrange(desc(diff_overallscore)) %>%
#mutate(year=as.factor(year)) %>%
head(n = top_n_values)
library(viridis)
plot_ly() %>%
add_trace(
type = "bar",
x = ~top_countries$country[top_countries$after2015 == 1],
y = ~top_countries$diff_overallscore[top_countries$after2015 == 1],
legendgroup = "after 2015",
name = "after 2015",
marker = list(color = "blue", size = 10)
) %>%
add_trace(
type = "bar",
x = ~top_countries$country[top_countries$after2015 == 0],
y = ~top_countries$diff_overallscore[top_countries$after2015 == 0],
legendgroup = "before 2015",
name = "before 2015",
marker = list(color = "red", size = 10)
) %>%
layout(
title = paste("Top ", top_n_values, " SDG Score evolution"),
yaxis = list(title = "Year difference SDG score", range = c(0, 3.5)),
xaxis = list(title = "Countries", categoryorder = "total ascending")
)
top_n_values <- 20
top_countries <- binary2015 %>%
arrange(desc(diff_overallscore)) %>%
#mutate(year=as.factor(year)) %>%
head(n = top_n_values)
library(viridis)
top_countries %>%
group_by(after2015) %>%
plot_ly(
type = "bar",
x = ~country,
y = ~diff_overallscore,
color = ~as.factor(after2015),
colors = c("red", "blue"),
showlegend = TRUE,
marker = list(size = 10)
) %>%
layout(
title = paste("Top ", top_n_values, " SDG Score evolution"),
yaxis = list(title = "Year difference SDG score", range = c(0, 3.5)),
xaxis = list(title = "Countries", categoryorder = "total ascending")
)
plot_ly() %>%
add_trace(
type = "bar",
x = ~top_countries$country[top_countries$after2015 == 1],
y = ~top_countries$diff_overallscore[top_countries$after2015 == 1],
legendgroup = "after 2015",
name = "after 2015",
marker = list(color = "blue", size = 10),
showlegend = TRUE,
position = "dodge"
) %>%
add_trace(
type = "bar",
x = ~top_countries$country[top_countries$after2015 == 0],
y = ~top_countries$diff_overallscore[top_countries$after2015 == 0],
legendgroup = "before 2015",
name = "before 2015",
marker = list(color = "red", size = 10),
showlegend = TRUE,
position = "dodge"
) %>%
layout(
title = paste("Top ", top_n_values, " SDG Score evolution"),
yaxis = list(title = "Year difference SDG score", range = c(0, 3.5)),
xaxis = list(title = "Countries", categoryorder = "total ascending"),
barmode = "stack"
)
plot_ly() %>%
add_trace(
type = "bar",
x = ~top_countries$country[top_countries$after2015 == 1],
y = ~top_countries$diff_overallscore[top_countries$after2015 == 1],
legendgroup = "after 2015",
name = "after 2015",
marker = list(color = "blue", size = 10),
showlegend = TRUE
) %>%
add_trace(
type = "bar",
x = ~top_countries$country[top_countries$after2015 == 0],
y = ~top_countries$diff_overallscore[top_countries$after2015 == 0],
legendgroup = "before 2015",
name = "before 2015",
marker = list(color = "red", size = 10),
showlegend = TRUE
) %>%
layout(
title = paste("Top ", top_n_values, " SDG Score evolution"),
yaxis = list(title = "Year difference SDG score", range = c(0, 5)),
xaxis = list(title = "Countries", categoryorder = "total ascending"),
barmode = "stack"
)
plot_ly() %>%
add_trace(
type = "bar",
data= binary2015 %>%
arrange(desc(diff_overallscore)) %>%
head(n = top_n_values),
x = ~top_countries$country[top_countries$after2015 == 1],
y = ~top_countries$diff_overallscore[top_countries$after2015 == 1],
legendgroup = "after 2015",
name = "after 2015",
marker = list(color = "blue", size = 10),
showlegend = TRUE
) %>%
add_trace(
type = "bar",
x = ~top_countries$country[top_countries$after2015 == 0],
y = ~top_countries$diff_overallscore[top_countries$after2015 == 0],
legendgroup = "before 2015",
name = "before 2015",
marker = list(color = "red", size = 10),
showlegend = TRUE
) %>%
layout(
title = paste("Top ", top_n_values, " SDG Score evolution"),
yaxis = list(title = "Year difference SDG score", range = c(0, 5)),
xaxis = list(title = "Countries", categoryorder = "total ascending"),
barmode = "stack"
)
plot_ly() %>%
add_trace(
type = "bar",
data= binary2015 %>%
arrange(desc(diff_overallscore)) %>%
head(n = top_n_values),
x = ~top_countries$country[top_countries$after2015 == 1],
y = ~top_countries$diff_overallscore[top_countries$after2015 == 1],
legendgroup = "after 2015",
name = "after 2015",
marker = list(color = "blue", size = 10),
showlegend = TRUE
) %>%
add_trace(
type = "bar",
x = ~top_countries$country[top_countries$after2015 == 0],
y = ~top_countries$diff_overallscore[top_countries$after2015 == 0],
legendgroup = "before 2015",
name = "before 2015",
marker = list(color = "red", size = 10),
showlegend = TRUE
) %>%
layout(
title = paste("Top ", top_n_values, " SDG Score evolution"),
yaxis = list(title = "Year difference SDG score", range = c(0, 5)),
xaxis = list(title = "Countries", categoryorder = "total ascending"),
barmode = "stack",
updatemenus = list(
list(
buttons = list(
list(
args = list("data", list(binary2015 %>%
arrange(desc(diff_overallscore)) %>%
head(n = top_n_values)),
"y", list(~top_countries$diff_overallscore[top_countries$after2015 == 1],
~top_countries$diff_overallscore[top_countries$after2015 == 0]
)),
label = "Overall score",
method = "restyle"
),
list(
args = list("data", list(binary2015 %>%
arrange(desc(diff_goal1)) %>%
head(n = top_n_values)),
"y", list(~top_countries$diff_goal1[top_countries$after2015 == 1],
~top_countries$diff_gaol1[top_countries$after2015 == 0]
)),
label = "Goal 1",
method = "restyle"
)))))
plot_ly() %>%
add_trace(
type = "bar",
data = binary2015 %>%
arrange(desc(diff_overallscore)) %>%
head(n = top_n_values),
x = ~country[after2015 == 1],
y = ~diff_overallscore[after2015 == 1],
legendgroup = "after 2015",
name = "after 2015",
marker = list(color = "blue", size = 10),
showlegend = TRUE
) %>%
add_trace(
type = "bar",
x = ~country[after2015 == 0],
y = ~diff_overallscore[after2015 == 0],
legendgroup = "before 2015",
name = "before 2015",
marker = list(color = "red", size = 10),
showlegend = TRUE
) %>%
layout(
title = paste("Top ", top_n_values, " SDG Score evolution"),
yaxis = list(title = "Year difference SDG score", range = c(0, 5)),
xaxis = list(title = "Countries", categoryorder = "total ascending"),
barmode = "stack",
updatemenus = list(
list(
buttons = list(
list(
args = list(
list(
data = binary2015 %>%
arrange(desc(diff_overallscore)) %>%
head(n = top_n_values),
x = ~country[after2015 == 1],
y = ~diff_overallscore[after2015 == 1]
),
"y", list(~diff_overallscore[after2015 == 1], ~diff_overallscore[after2015 == 0])
),
label = "Overall score",
method = "restyle"
),
list(
args = list(
list(
data = binary2015 %>%
arrange(desc(diff_goal1)) %>%
head(n = top_n_values),
x = ~country[after2015 == 1],
y = ~diff_goal1[after2015 == 1]
),
"y", list(~diff_goal1[after2015 == 1], ~diff_goal1[after2015 == 0])
),
label = "Goal 1",
method = "restyle"
)
)
)
)
)
