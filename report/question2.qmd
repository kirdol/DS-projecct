```{r, echo = FALSE, message = FALSE, warning = FALSE}
source(here::here("scripts/Clean/setup.R"))
```

## Focus on the evolution of SDG scores over time

**How has the adoption of the SDGs in 2015 influenced the achievement of SDGs?**

We create one new variable per goal that captures the difference in SDG score between the year of the observation and the previous year. This will allow us to see how the countries improve (or not) on SDG scores each year.

```{r, echo = TRUE, message = FALSE, warning=FALSE, out.height="100%", out.width="100%"}
data_question2 <- read.csv(here("scripts", "data", "data_question24.csv"))
data_question2 <- data_question2 %>%
  dplyr::select(-X)

data_question2 <- data_question2 %>% 
  group_by(code) %>%
  mutate(across(5:21, ~ . - dplyr::lag(.), .names = "diff_{.col}")) %>%
  ungroup()
```

### EDA: General time evolution of SDG socres

First, we look at the evolution of SDG achievement overall score over time by continent and by region and we see that the general evolution of SDG scores around the world is increasing over the years, but very slowly. We also plot the average improvements/decrease in overall score acros the years. Looking at the continents, we see that Europe is above the others, while Africa is below, but in general, all have increasing overall scores. In addition, we see that the different continent have quite steady score difference between the years, except Oceania that has greater fluctuations and has sometimes score decrease, for instance in 2010. But it also comes with the higher average increase in 2014. We also observe that toward the latest years (2021-2022), the improvements are smaller and that decrease are more frequent. However, we must keep in mind that all are very small differences, indeed, the higher improvement is a little above 1 point of percentage of the overall score in one year. 

```{r, echo = TRUE, message = FALSE, warning=FALSE, fig.height=2.5}
#### Mean overall SDG score and score difference by year ####

data1 <- data_question2 %>%
  group_by(year, continent) %>%
  mutate(mean_overall_score_by_year = mean(overallscore))

# Mean overall SDG achievement score by year plot
plot1 <- ggplot(data1) +
  geom_line(mapping = aes(x = year,
                        y = mean_overall_score_by_year,
                        color = continent),
            lwd = 0.6) +
  scale_y_continuous(limits = c(0, 100)) +
  labs(title = "Mean overall SDG \nachievement score",
       y = "Mean Overall SDG Score",
       x = "Year"
       ) +
  theme(legend.position = "none",
        plot.title = element_text(hjust = 0.5, size = 10),
        axis.title.x = element_text(size = 8),
        axis.title.y = element_text(size = 8)) +
  Discrete_colors

data2 <- data_question2 %>%
  group_by(year, continent) %>%
  mutate(mean_diff_overall_score_by_year = mean(diff_overallscore))


# Mean score difference by year plot
plot2 <- ggplot(data2) +
  geom_line(mapping=aes(x=year,
                        y=mean_diff_overall_score_by_year,
                        color=continent),
            lwd=0.6) +
  geom_hline(yintercept = 0,
             linetype = "dashed",
             color = "black") + 
  scale_y_continuous(limits = c(-0.4, 1.2)) +
  labs(title = "Score difference",
       y = "Mean Overall SDG Score difference",
       x = "Year"
       ) +
  theme(legend.position = "right",
        plot.title = element_text(hjust = 0.5, size = 10),
        axis.title.x = element_text(size = 8),
        axis.title.y = element_text(size = 8),
        legend.text = element_text(size = 8),
        legend.title = element_text(size = 10)) +
  Discrete_colors

plot1 + plot2
```

This view that groups the countries by region gives us precision about the previous information. Indeed, it is Western Europe that is particularly above and Sub-Saharan Africa that is clearly below. Regarding the score difference from one year to another, we still see Oceania having the greater fluctuations, but Caucasus & Central Asia as well as Eastern Europe show a pick in the early two thousand's that we could not see before. South Asia also has a relatively high improvement in 2017. 

```{r, echo = TRUE, message = FALSE, warning=FALSE}
#### Evoloution of the mean overall score and socre diff by region ####

data3 <- data_question2 %>%
  group_by(year, region) %>%
  mutate(mean_overall_score_by_year=mean(overallscore))

# Evolution of the mean overall SDG achievement score plot
plot3 <- ggplot(data3) +
  geom_line(mapping=aes(x = year,
                        y = mean_overall_score_by_year,
                        color = region),
            lwd = 0.5) +
  scale_y_continuous(limits = c(0, 100)) +
  labs(title = "Evolution of the mean \noverall SDG achievement score",
       y = "Mean Overall SDG Score",
       x = "Year") +
  theme(legend.position="none",
        plot.title = element_text(hjust = 0.5, size = 10),
        axis.title.x = element_text(size = 8),
        axis.title.y = element_text(size = 8),
        legend.text = element_text(size = 8),
        legend.title = element_text(size = 10)) +
  colors_pal

data4 <- data_question2 %>%
  group_by(year, region) %>%
  mutate(mean_diff_overall_score_by_year = mean(diff_overallscore))

# Evolution of the mean score difference plot
plot4 <- ggplot(data4) +
  geom_line(mapping=aes(x = year,
                        y = mean_diff_overall_score_by_year,
                        color = region),
            lwd = 0.5) +
  geom_hline(yintercept = 0,
             linetype = "dashed",
             color = "black") +
  scale_y_continuous(limits = c(-0.4,1.2)) +
  labs(title = "Score difference",
       y = "Mean Overall SDG Score difference",
       x = "Year"
       ) +
  theme(legend.position = "none",
        plot.title = element_text(hjust = 0.5, size = 10),
        axis.title.x = element_text(size = 8),
        axis.title.y = element_text(size = 8),
        legend.text = element_text(size = 8),
        legend.title = element_text(size = 10)) +
  colors_pal

# Creation of the legend
legend <- ggplot(data4) +
  geom_line(mapping=aes(x = year,
                        y = mean_diff_overall_score_by_year,
                        color = region),
            lwd = 0.5) +
  theme(legend.position = "bottom",
        legend.text = element_text(size = 6),
        legend.title = element_text(size = 8))+
  guides(color = guide_legend(nrow = 4)) +
  colors_pal

legend <- cowplot::get_legend(legend)

(plot3 + plot4) / legend
```

Second, we look at the evolution of SDG achievement scores(16) over time for the whole world and by continent. We notice that all SDGs except from goal 9 (industry innovation and infrastructure) are close to one another in terms of level and growth. Goal 9 starts far below the others in 2000 and growths faster until exceeding 50%. In addition, some goals did not increase their scores much in the last two decades, for example goal 13 (climate action) and goal 12 (responsible consumption and production).
The score differences are mostly contained between 0 and 0.5 point of percentage increase by year. Some of the goals have picks, these are goals 15, 3, 5, 17 and goal 9 has the highest of all average improvements in 2017 with an improvement of 4 points of percentage, which is almost two times higher than the other good improvements. Some goals have bad years, like goal 10 or goal 15, but never under -0.5, except goal 16 in 2022 that goes a little below. Finaly, some goals are very steady, for example goal 12 that stays around zero and goal 6 that is always a little above the zero (no change) line. 

```{r, echo = TRUE, message = FALSE,  warning = FALSE, out.height="200%"}
#### Evolution  of the mean scores and score difference by year ####

data5 <- data_question2 %>%
  group_by(year) %>%
  summarise(across(starts_with("goal"), mean, na.rm=TRUE)) %>%
  pivot_longer(cols = starts_with("goal"), names_to = "goal", values_to = "mean_value")

# Evolution of the mean SDG achievement scores across the world plot
plot5 <- ggplot(data = data5) +
  geom_line(mapping = aes(x = year, y = mean_value, color = goal), size = 0.7) +
  geom_point(mapping = aes(x = year, y = mean_value, color = goal), size = 1) +
  Discrete_colors +
  scale_y_continuous(limits = c(0, 100)) +
  labs(title = "Evolution of the mean SDG \nachievement scores across the world",
       y = "Mean SDG Scores",
       x = "Year"
       ) +
  theme(legend.position="none", plot.title = element_text(hjust=0.5, size= 10), axis.title.x = element_text(size= 8), axis.title.y = element_text(size= 8))

data6 <- data_question2 %>%
  group_by(year) %>%
  summarise(across(starts_with("diff_goal"), mean, na.rm=TRUE)) %>%
  pivot_longer(cols = starts_with("diff_goal"), names_to = "goal", values_to = "mean_diff_value")

# Score difference plot
plot6 <- ggplot(data = data6) +
  geom_line(mapping = aes(x = year, y = mean_diff_value, color = goal), size = 0.3) +
  #geom_point(mapping = aes(x = year, y = mean_diff_value, color = goal), size = 1) +
  geom_hline(yintercept = 0, linetype = "dashed", color = "black") +
  Discrete_colors +
  scale_y_continuous(limits = c(-1.5, 4)) +
  labs(title = "Score difference",
       y = "Mean SDG Scores difference",
       x = "Year"
       ) +
  theme(legend.position="none", plot.title = element_text(hjust=0.5, size= 10), axis.title.x = element_text(size= 8), axis.title.y = element_text(size= 8), legend.text = element_text(size= 6),legend.title = element_text(size= 10))

# Creation od the legend
plot7 <- ggplot(data = data5) +
  geom_line(mapping = aes(x = year, y = mean_value, color = goal), size = 1) +
  Discrete_colors +
  theme(legend.position="bottom", legend.text = element_text(size= 8), legend.title = element_blank())+
  guides(color = guide_legend(nrow=3))

legend <- cowplot::get_legend(plot7)

(plot5 + plot6) / legend
```

We continue with the graph that distinguishes continents to get more information.

```{r, echo = TRUE, message = FALSE, warning=FALSE, out.height="100%", out.width="100%"}
#### Evolution of the mean scores by continent ####

data5 <- data_question2 %>%
  group_by(year, continent) %>%
  summarise(across(starts_with("goal"), mean, na.rm=TRUE)) %>%
  pivot_longer(cols = starts_with("goal"), names_to = "goal", values_to = "mean_value")

# Creation of the plot
ggplot(data = data5) +
  geom_line(mapping = aes(x = year,
                          y = mean_value,
                          color = continent),
            size = 0.7) +
  scale_y_continuous(limits = c(0, 100)) +
  labs(title = "Evolution of the mean SDG achievement scores by continent",
       y = "Mean SDG Scores",
       x = "Year"
  ) +
  facet_wrap(~ goal, nrow = 4) +
  theme_light() +
  theme(axis.text.x = element_text(angle = 45, vjust = 1, hjust = 1, size = 6),
        plot.title = element_text(hjust=0.5, size=10)) +
  colors_pal
```

We observe that most of the time, Europe is at the top of the graph and Africa at the bottom, except for goals 12 and 13 that are linked to ecology. Some other information stand out:

-   Americas are far behind the other parts of the world regarding goal 10: reduced inequalities.

-   Africa is far behind the other continents (even if becoming better) for goals 1, 3, 4 and 7.

-   Goal 9 (industry, innovation and infrastructure) show exponential growth for almost all continents.

Third we create an interactive map of the world to be able to navigate from year 2000 to 2022, seeing the level of achievement of the SDGs (overall score) for each country.

```{r, echo = TRUE, message = FALSE, warning = FALSE, fig.height=1.5}
#### Interactive map of the world showing the scores by contries ####

# Load world map data
world <- ne_countries(scale = "medium",returnclass = "sf")

# Merge data with the world map data
data0 <- merge(world, data_question2, by.x = "iso_a3", by.y = "code", all.x = TRUE)

data0 <- data0 %>%
  filter(!is.na(overallscore))

unique_years <- unique(data0$year)

plot_ly(
  type = "choropleth",
  z = ~data0$overallscore[data0$year == 2000],
  locations = ~data0$iso_a3[data0$year == 2000],
  text = ~paste("Country: ",
                data0$name[data0$year == 2000],
                "<br>Overall Score: ",
                data0$overallscore[data0$year == 2000]),
  colors =  viridis(4, direction = -1),
  # colors = c("darkred",
  #            "orange",
  #            "yellow",
  #            "darkgreen"),
  colorbar = list(title = "Overall Score",
                  cmin = 40,
                  cmax = 87),
  zmin = 40,
  zmax = 87,
  hoverinfo = "text") %>%
  layout(
    title = "SDG overall score evolution",
    sliders = list(
      list(
        active = 0,
        currentvalue = list(prefix = "Year: "),
        steps = lapply(seq_along(unique_years), function(i) {
          year <- unique_years[i]
          list(
            label = as.character(year),
            method = "restyle",
            args = list(
              list(
                z = list(data0$overallscore[data0$year == year]),
                locations = list(data0$iso_a3[data0$year == year]),
                text = list(~paste("Country: ",
                                   data0$name[data0$year == year],
                                   "<br>Overall Score: ",
                                   data0$overallscore[data0$year == year]))
              )
            )
          )
        })
      )
    )
  )
```

Again, we see that the overall achievement score of the SDGs is increasing and that the countries that have the most red (bad score) are in Africa. However it is also there that it increases more rapidly. Our hypothesis is that when a score is very low, it is easier to make it better than when it becomes very high (around 90%) it may be hard to increase it, because it would mean perfection. In the next section, we will further investigate this idea.

### Analysis: SDG adoption in 2015

Preparing for the specific question around 2015, we only keep the years from 2009 to 2022 (7 years before and after 2015).In addition, we create a binary variable that take the value 1 if the observation occurred after 2015 and zero otherwise.

```{r, echo = TRUE, message = FALSE, warning = FALSE, out.height="100%", out.width="100%"}
# Create a new column (binary variable) with value 1 if the year is after 2015 and zero otherwise. 
binary2015 <- data_question2 %>% 
  mutate(after2015 = ifelse(year > 2015, 1, 0)) %>%
  filter(as.numeric(year)>=2009)
```

We begin by looking at the distribution of the difference in SDG scores from one year to the next (improvement if it is above zero and deterioration if it is below zero).

```{r, echo = TRUE, message = FALSE, warning = FALSE, out.height="100%", out.width="100%"}
# histogram of difference in scores between years
unique_years <- unique(binary2015$year)
plot_ly() %>%
  add_trace(
    type = "histogram", 
    data = binary2015, 
    x = ~diff_overallscore[year == 2009],
    marker = list(color = Fix_color, line = list(color = "black", width = 1))
  ) %>%
  layout(
    title = "Distribution of SDG evolution",
    xaxis = list(title = "Year difference SDG score", range = c(-3, 3)),
    yaxis = list(title = "Frequency", range = c(0, 40)),
    sliders = list(
      list(
        active = 0,
        currentvalue = list(prefix = "Year: "),
        steps = lapply(seq_along(unique_years), function(i) {
          year <- unique_years[i]
          list(
            label = as.character(year),
            method = "restyle",
            args = list(
              list(x = list(binary2015$diff_overallscore[binary2015$year == year]))
            )
          )
        })
      )
    )
  )
```

We notice that across the years, the distribution stays on the right of the x-axis, which means that there are more improvement than deterioration. If there is deterioration, it is less than one percent per year, except some extreme cases, for instance in 2013, there was almost a 3% decrease in the overall SDG score of one country. It is also rare to see improvements of more than 2% per year. Regarding our specific question, we do not see a major improvement of the distribution after 2015, if it was the case we would see the distribution going more to the right, but except for 2017, there are more and more values centered around zero, which means less score improvements overall.

After having visualized the improvements and declines of SDG overall score for the whole world, we are now interested in the top 5 countries in terms of improvement each year and we see that major improvement often comes from Sub-Saharan Africa countries or Middle East and North Africa. This confirms that more efforts are made in these regions to achieve better scores, but we also know from our previous visualizations that their initial scores are lower. Moreover, we record that the higher improvements are of 3% per year and were mostly achieved before 2015. Indeed, we can tell that in terms of maximum improvements, the adoption of SDGs in 2015 did not have a strong impact. We also notice that 2020 is the year with the smallest best improvements. We keep that in mind for the next question regarding events and specifically COVID.

```{r, echo = TRUE, message = FALSE, warning = FALSE, out.height="100%"}
top_n_values <- 5

# Test with ggpot2
custom_colors <- c(viridis(5, begin = 0.2), "lightblue", "grey90", magma(3))

# Get unique regions in the dataset
unique_regions <- unique(binary2015$region)

# Create a color dictionary mapping each region to a specific color
region_colors <- setNames(custom_colors[1:length(unique_regions)], unique_regions)

library(patchwork)

plots <- list()

for (year in unique_years) {
  top_countries <- binary2015[binary2015$year == year, ] %>%
    arrange(desc(year), desc(diff_overallscore)) %>%
    head(n = top_n_values)
  
  plot <- ggplot(data = top_countries,
                 mapping = aes(x = country,
                               y = diff_overallscore,
                               fill = region)) +
    geom_bar(stat = "identity") +
    scale_fill_manual(values = region_colors) +  # Use the specified colors
    labs(title = paste(year),
         x = NULL,
         y = NULL) +
    theme_minimal() +
    theme(axis.text.x = element_text(angle = 45, vjust = 1, hjust = 1, size= 6),
          axis.text.y = element_text(size= 6),
          legend.position = "none",
          plot.title = element_text(size = 10)) + 
    scale_y_continuous(limits = c(0, 3.7))
  
  plots[[as.character(year)]] <- plot
}

wrap <- wrap_plots(plots, ncol = 5)

wrap+ plot_annotation(
  title = 'Best 5 countries in terms of SDG score improvement by region'
)
```

```{r, echo = TRUE, message = FALSE, warning = FALSE, fig.height=0.5}
legend_data <- data.frame(region = unique_regions)
legend_plot <- ggplot(legend_data, aes(x = region, fill = region)) +
  geom_bar() +
  scale_fill_manual(values = region_colors) +
  theme(legend.position="top",
        legend.text = element_text(size = 6), 
        legend.title = element_blank(), legend.key.size = unit(0.3, "cm"))+
  guides(fill = guide_legend(nrow=2))

legend <- cowplot::get_legend(legend_plot)

grid.newpage()
grid.draw(legend)

```

We continue by looking at the worst 5 countries in terms of decline in SDG overall score each year and we see that the years with the worst declines are those closer to us. Indeed the declines were generally no more than 1%, until 2018, where these became more frequent. We notice that the adoption of SDGs in 2015 may have had a good impact, because during the two years that follow, the worst SDG score declines were low (no more than 1% in 2016 and no more 0.5% in 2017). It was stabilizing, but it was of short duration, because then come the more extreme deteriotations. Interestingly, the regions that had were the worst in terms of decline during the past twelve years were very different, the only pattern appears during the last four years, where most of them are in Latin America and the Caribbean.

```{r, echo = TRUE, message = FALSE, warning = FALSE}
plots <- list()

for (year in unique_years) {
  top_countries <- binary2015[binary2015$year == year, ] %>%
    arrange(desc(year), diff_overallscore) %>%
    head(n = top_n_values)
  
  plot <- ggplot(data = top_countries,
                 mapping = aes(x = country,
                               y = diff_overallscore,
                               fill = region)) +
    geom_bar(stat = "identity") +
    scale_fill_manual(values = region_colors) +  # Use the specified colors
    labs(title = paste(year),
         x = NULL,
         y = NULL) +
    theme_minimal() +
    theme(axis.text.x = element_text(angle = 45,vjust = 1, hjust = 1, size=6),
          axis.text.y = element_text(size= 6), legend.position = "none",
          plot.title = element_text(size = 10)) + 
    scale_y_continuous(limits = c(-3,0))
  
  plots[[as.character(year)]] <- plot
}

# Arrange the plots in a 4x4 grid using patchwork
wrap <- wrap_plots(plots, ncol = 5)

wrap + plot_annotation(
  title = 'Worst 5 countries in terms of SDG score improvement'
)
```

```{r, echo = TRUE, message = FALSE, warning = FALSE, fig.height=0.5}
grid.draw(legend)

```

We move on to the specific SDG scores and look at the 20 best improvements by score. We additionaly differentiate between the improvements than occurred before and after 2015. We want to see which goals get the best improvements and which countries put more effort into it.

```{r, echo = TRUE, message = FALSE, warning = FALSE, out.width="100%", out.height="75%"}
# Best improvements
data_long <- binary2015 %>%
  pivot_longer(cols = c(starts_with("diff_goal"), "diff_overallscore"),
               names_to = "goal", values_to = "improvement") %>%
  group_by(goal) %>%
  top_n(20, wt = improvement) %>%
  ungroup()

plot_ly() %>%
  add_trace(
    type = "bar",
    data = data_long,
    x = ~country[after2015 == 1 & goal == "diff_overallscore"],
    y = ~improvement[after2015 == 1 & goal == "diff_overallscore"],
    legendgroup = "after 2015",
    name = "after 2015",
    marker = list(color = Fix_color, size = 10),
    showlegend = TRUE
  ) %>%
  add_trace(
    type = "bar",
    x = ~country[after2015 == 0 & goal == "diff_overallscore"],
    y = ~improvement[after2015 == 0 & goal == "diff_overallscore"],
    legendgroup = "before 2015",
    name = "before 2015",
    marker = list(color = viridis(1), size = 10),
    showlegend = TRUE
  ) %>%
  layout(
    title = paste("Top 20 countries per SDG Score evolution"),
    yaxis = list(title = "Year difference SDG score", range = c(0, 50)),
    xaxis = list(title = "Countries", categoryorder = "total ascending", tickangle = -45),
    barmode = "stack",
    updatemenus = list(
      list(
        buttons = list(
          list(
            args = list(
              list(
                y = list(
                  ~improvement[after2015 == 1 & goal == "diff_overallscore"],
                  ~improvement[after2015 == 0 & goal == "diff_overallscore"]
                ),
                x = list(
                  ~country[after2015 == 1 & goal == "diff_overallscore"],
                  ~country[after2015 == 0 & goal == "diff_overallscore"]
                )
              )
            ),
            label = "Overall score",
            method = "restyle"
          ),
          list(
            args = list(
              list(
                y = list(
                  ~improvement[after2015 == 1 & goal == "diff_goal1"],
                  ~improvement[after2015 == 0 & goal == "diff_goal1"]
                ),
                x = list(
                  ~country[after2015 == 1 & goal == "diff_goal1"],
                  ~country[after2015 == 0 & goal == "diff_goal1"]
                )
              )
            ),
            label = "Goal 1: \nno poverty",
            method = "restyle"
          ),
          list(
            args = list(
              list(
                y = list(
                  ~improvement[after2015 == 1 & goal == "diff_goal2"],
                  ~improvement[after2015 == 0 & goal == "diff_goal2"]
                ),
                x = list(
                  ~country[after2015 == 1 & goal == "diff_goal2"],
                  ~country[after2015 == 0 & goal == "diff_goal2"]
                )
              )
            ),
            label = "Goal 2: \nzero hunger",
            method = "restyle"
          ),
          list(
            args = list(
              list(
                y = list(
                  ~improvement[after2015 == 1 & goal == "diff_goal3"],
                  ~improvement[after2015 == 0 & goal == "diff_goal3"]
                ),
                x = list(
                  ~country[after2015 == 1 & goal == "diff_goal3"],
                  ~country[after2015 == 0 & goal == "diff_goal3"]
                )
              )
            ),
            label = "Goal 3: good health \nand well-being",
            method = "restyle"
          ),
          list(
            args = list(
              list(
                y = list(
                  ~improvement[after2015 == 1 & goal == "diff_goal4"],
                  ~improvement[after2015 == 0 & goal == "diff_goal4"]
                ),
                x = list(
                  ~country[after2015 == 1 & goal == "diff_goal4"],
                  ~country[after2015 == 0 & goal == "diff_goal4"]
                )
              )
            ),
            label = "Goal 4: \nquality education",
            method = "restyle"
          ),
          list(
            args = list(
              list(
                y = list(
                  ~improvement[after2015 == 1 & goal == "diff_goal5"],
                  ~improvement[after2015 == 0 & goal == "diff_goal5"]
                ),
                x = list(
                  ~country[after2015 == 1 & goal == "diff_goal5"],
                  ~country[after2015 == 0 & goal == "diff_goal5"]
                )
              )
            ),
            label = "Goal 5: \ngender equality",
            method = "restyle"
          ),
          list(
            args = list(
              list(
                y = list(
                  ~improvement[after2015 == 1 & goal == "diff_goal6"],
                  ~improvement[after2015 == 0 & goal == "diff_goal6"]
                ),
                x = list(
                  ~country[after2015 == 1 & goal == "diff_goal6"],
                  ~country[after2015 == 0 & goal == "diff_goal6"]
                )
              )
            ),
            label = "Goal 6: clean water \nand sanitation",
            method = "restyle"
          ),
          list(
            args = list(
              list(
                y = list(
                  ~improvement[after2015 == 1 & goal == "diff_goal7"],
                  ~improvement[after2015 == 0 & goal == "diff_goal7"]
                ),
                x = list(
                  ~country[after2015 == 1 & goal == "diff_goal7"],
                  ~country[after2015 == 0 & goal == "diff_goal7"]
                )
              )
            ),
            label = "Goal 7: affordable \nand clean energy",
            method = "restyle"
          ),
          list(
            args = list(
              list(
                y = list(
                  ~improvement[after2015 == 1 & goal == "diff_goal8"],
                  ~improvement[after2015 == 0 & goal == "diff_goal8"]
                ),
                x = list(
                  ~country[after2015 == 1 & goal == "diff_goal8"],
                  ~country[after2015 == 0 & goal == "diff_goal8"]
                )
              )
            ),
            label = "Goal 8: decent work \nand economic growth",
            method = "restyle"
          ),
          list(
            args = list(
              list(
                y = list(
                  ~improvement[after2015 == 1 & goal == "diff_goal9"],
                  ~improvement[after2015 == 0 & goal == "diff_goal9"]
                ),
                x = list(
                  ~country[after2015 == 1 & goal == "diff_goal9"],
                  ~country[after2015 == 0 & goal == "diff_goal9"]
                )
              )
            ),
            label = "Goal 9: industry, innovation \nand infrastructure",
            method = "restyle"
          ),
          list(
            args = list(
              list(
                y = list(
                  ~improvement[after2015 == 1 & goal == "diff_goal10"],
                  ~improvement[after2015 == 0 & goal == "diff_goal10"]
                ),
                x = list(
                  ~country[after2015 == 1 & goal == "diff_goal10"],
                  ~country[after2015 == 0 & goal == "diff_goal10"]
                )
              )
            ),
            label = "Goal 10: \nreduced inequalities",
            method = "restyle"
          ),
          list(
            args = list(
              list(
                y = list(
                  ~improvement[after2015 == 1 & goal == "diff_goal11"],
                  ~improvement[after2015 == 0 & goal == "diff_goal11"]
                ),
                x = list(
                  ~country[after2015 == 1 & goal == "diff_goal11"],
                  ~country[after2015 == 0 & goal == "diff_goal11"]
                )
              )
            ),
            label = "Goal 11: sustainable \ncities and communities",
            method = "restyle"
          ),
          list(
            args = list(
              list(
                y = list(
                  ~improvement[after2015 == 1 & goal == "diff_goal12"],
                  ~improvement[after2015 == 0 & goal == "diff_goal12"]
                ),
                x = list(
                  ~country[after2015 == 1 & goal == "diff_goal12"],
                  ~country[after2015 == 0 & goal == "diff_goal12"]
                )
              )
            ),
            label = "Goal 12: responsible \nconsumption and production",
            method = "restyle"
          ),
          list(
            args = list(
              list(
                y = list(
                  ~improvement[after2015 == 1 & goal == "diff_goal13"],
                  ~improvement[after2015 == 0 & goal == "diff_goal13"]
                ),
                x = list(
                  ~country[after2015 == 1 & goal == "diff_goal13"],
                  ~country[after2015 == 0 & goal == "diff_goal13"]
                )
              )
            ),
            label = "Goal 13: \nclimate action",
            method = "restyle"
          ),
          list(
            args = list(
              list(
                y = list(
                  ~improvement[after2015 == 1 & goal == "diff_goal15"],
                  ~improvement[after2015 == 0 & goal == "diff_goal15"]
                ),
                x = list(
                  ~country[after2015 == 1 & goal == "diff_goal15"],
                  ~country[after2015 == 0 & goal == "diff_goal15"]
                )
              )
            ),
            label = "Goal 15: \nlife on earth",
            method = "restyle"
          ),
          list(
            args = list(
              list(
                y = list(
                  ~improvement[after2015 == 1 & goal == "diff_goal16"],
                  ~improvement[after2015 == 0 & goal == "diff_goal16"]
                ),
                x = list(
                  ~country[after2015 == 1 & goal == "diff_goal16"],
                  ~country[after2015 == 0 & goal == "diff_goal16"]
                )
              )
            ),
            label = "Goal 16: peace, justice \nand strong institutions",
            method = "restyle"
          ),
          list(
            args = list(
              list(
                y = list(
                  ~improvement[after2015 == 1 & goal == "diff_goal17"],
                  ~improvement[after2015 == 0 & goal == "diff_goal17"]
                ),
                x = list(
                  ~country[after2015 == 1 & goal == "diff_goal17"],
                  ~country[after2015 == 0 & goal == "diff_goal17"]
                )
              )
            ),
            label = "Goal 17: partnerships \nfor the goals",
            method = "restyle"
          )
        )
      )
    )
  )
```

We notice various patterns, among them:

-   Goals 2 (zero hunger), 3 (good health and well-being), 6 (clean water and sanitation), 8 (decent work and economic growth), 12 (responsible consumption and production), 16 (peace, justice and strong institutions) have very low improvements per year. Indeed, even the best ones are below 10%.

-   Goal 10 (reduced inequalities) has the best improvements, all 20 best improvements are above 20% and it goes up to 45%.

-   Some goals clearly had most of their best improvements before 2015: goals 3 (good health and well-being), 5 (gender equality), 6 (clean water and sanitation), 7 (affordable and clean energy).

-   Some goals clearly had most of their best improvements after 2015: goals 8 (decent work and economic growth), 12 (responsible consumption and production).

-   Goal 9 (industry, innovation and infrastructure) has all of its 20 best improvements after 2015.

Regarding the impact of the adoption of SDGs in 2015, we can not tell that it had a positive impact, because there are not more big improvements after 2015 than before, even a little bit less. In addition, the most impressive improvements mostly occurred before 2015. These conclusions are supported by the next graph: we fit two different regression lines (before and after 2015) to see if there is a jump after the adoption of the SDGs and if the the SDG scores increase faster. We decided to cut the y-axis in order to have a better visual of the different scores. Since the regressions lines (taking into account all of the goals) go between 30% and 85% we only kept those values.

```{r, echo = TRUE, message = FALSE, warning = FALSE, out.height="100%", out.width="100%"}
# Graphs to show the jump (or not) in 2015

# Filter data
data_after_2015 <- filter(binary2015, as.numeric(year) >= 2015)
data_before_2016 <- filter(binary2015, as.numeric(year) <= 2015)

plotly::plot_ly() %>%
  plotly::add_trace(data = data_after_2015, x = ~year, y = ~fitted(lm(overallscore ~ year, data = data_after_2015)), type = 'scatter', mode = 'lines', line = list(color = Fix_color), name = "After 2015") %>%
  plotly::add_trace(data = data_before_2016, x = ~year, y = ~fitted(lm(overallscore ~ year, data = data_before_2016)), type = 'scatter', mode = 'lines', line = list(color = viridis(1)), name = "Before 2015") %>%
  plotly::layout(title = "Different patterns across SDGs before and after 2015",
         xaxis = list(title = "Year"),
         yaxis = list(title = "SDG achievement score", range = c(30, 90)),
         shapes = list(
           list(
             type = 'line',
             x0 = 2015,
             x1 = 2015,
             y0 = 0,
             y1 = 1,
             yref = 'paper',
             line = list(color = 'grey', width = 2, dash = 'dot')
           )
         ),
         updatemenus = list(
           list(
             buttons = list(
               list(
                 args = list("y", list(
                   ~fitted(lm(overallscore ~ year, data = data_after_2015)),
                   ~fitted(lm(overallscore ~ year, data = data_before_2016))
                 )),
                 label = "Overall score",
                 method = "restyle"
               ),
               list(
                 args = list("y", list(
                   ~fitted(lm(goal1 ~ year, data = data_after_2015)),
                   ~fitted(lm(goal1 ~ year, data = data_before_2016))
                 )),
                 label = "Goal 1: \nno poverty",
                 method = "restyle"
               ),
               list(
                 args = list("y", list(
                   ~fitted(lm(goal2 ~ year, data = data_after_2015)),
                   ~fitted(lm(goal2 ~ year, data = data_before_2016))
                 )),
                 label = "Goal 2: \nzero hunger",
                 method = "restyle"
               ),
               list(
                 args = list("y", list(
                   ~fitted(lm(goal3 ~ year, data = data_after_2015)),
                   ~fitted(lm(goal3 ~ year, data = data_before_2016))
                 )),
                 label = "Goal 3: good health \nand well-being",
                 method = "restyle"
               ),
               list(
                 args = list("y", list(
                   ~fitted(lm(goal4 ~ year, data = data_after_2015)),
                   ~fitted(lm(goal4 ~ year, data = data_before_2016))
                 )),
                 label = "Goal 4: \nquality education",
                 method = "restyle"
               ),
               list(
                 args = list("y", list(
                   ~fitted(lm(goal5 ~ year, data = data_after_2015)),
                   ~fitted(lm(goal5 ~ year, data = data_before_2016))
                 )),
                 label = "Goal 5: \ngender equality",
                 method = "restyle"
               ), 
               list(
                 args = list("y", list(
                   ~fitted(lm(goal6 ~ year, data = data_after_2015)),
                   ~fitted(lm(goal6 ~ year, data = data_before_2016))
                 )),
                 label = "Goal 6: clean water \nand sanitation",
                 method = "restyle"
               ),
               list(
                 args = list("y", list(
                   ~fitted(lm(goal7 ~ year, data = data_after_2015)),
                   ~fitted(lm(goal7 ~ year, data = data_before_2016))
                 )),
                 label = "Goal 7: affordable \nand clean energy",
                 method = "restyle"
               ),
               list(
                 args = list("y", list(
                   ~fitted(lm(goal8 ~ year, data = data_after_2015)),
                   ~fitted(lm(goal8 ~ year, data = data_before_2016))
                 )),
                 label = "Goal 8: decent work \nand economic growth",
                 method = "restyle"
               ),
               list(
                 args = list("y", list(
                   ~fitted(lm(goal9 ~ year, data = data_after_2015)),
                   ~fitted(lm(goal9 ~ year, data = data_before_2016))
                 )),
                 label = "Goal 9: industry, innovation \nand infrastructure",
                 method = "restyle"
               ), 
               list(
                 args = list("y", list(
                   ~fitted(lm(goal10 ~ year, data = data_after_2015)),
                   ~fitted(lm(goal10 ~ year, data = data_before_2016))
                 )),
                 label = "Goal 10: \nreduced inequalities",
                 method = "restyle"
               ),
               list(
                 args = list("y", list(
                   ~fitted(lm(goal11 ~ year, data = data_after_2015)),
                   ~fitted(lm(goal11 ~ year, data = data_before_2016))
                 )),
                 label = "Goal 11: sustainable \ncities and communities",
                 method = "restyle"
               ),
               list(
                 args = list("y", list(
                   ~fitted(lm(goal12 ~ year, data = data_after_2015)),
                   ~fitted(lm(goal12 ~ year, data = data_before_2016))
                 )),
                 label = "Goal 12: responsible \nconsumption and production",
                 method = "restyle"
               ),
               list(
                 args = list("y", list(
                   ~fitted(lm(goal13 ~ year, data = data_after_2015)),
                   ~fitted(lm(goal13 ~ year, data = data_before_2016))
                 )),
                 label = "Goal 13: \nclimate action",
                 method = "restyle"
               ), 
               list(
                 args = list("y", list(
                   ~fitted(lm(goal15 ~ year, data = data_after_2015)),
                   ~fitted(lm(goal15 ~ year, data = data_before_2016))
                 )),
                 label = "Goal 15: \nlife on earth",
                 method = "restyle"
               ),
               list(
                 args = list("y", list(
                   ~fitted(lm(goal16 ~ year, data = data_after_2015)),
                   ~fitted(lm(goal16 ~ year, data = data_before_2016))
                 )),
                 label = "Goal 16: peace, justice \nand strong institutions",
                 method = "restyle"
               ),
               list(
                 args = list("y", list(
                   ~fitted(lm(goal17 ~ year, data = data_after_2015)),
                   ~fitted(lm(goal17 ~ year, data = data_before_2016))
                 )),
                 label = "Goal 17: partnerships \nfor the goals",
                 method = "restyle"
               )
             )
           )
         )
  )
```

We notice various patterns, among them:

-   Goals 1, 4, 3, and 15 increase faster before 2015 than after.

-   Except for goal 17, none seem to increase faster after the adoption of SDGs. Since goal 17 is about collaboration of the countries for SDGs achievement, it is no surprise that before the adoption, there were no increase. It is thus disappointing to see that it is the only goal that has a improvement rate after 2015.

-   Goal 17 also has a small downward jump in 2015, but since it immediately increases in the following years, it is due to the fitting of the lines.

-   We observe small upwards jumps for goals 8, 9, 10 and 11.

To sum up, the adoption of SDGs was a success in terms of collaboration between countries to better themselves on some aspects of durability (goal 17), but regarding the goals themselves, we can not conclude to faster improvements or radical efforts following 2015.
